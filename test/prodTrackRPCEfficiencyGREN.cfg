process RPCEff = {
	source = PoolSource{
	untracked vstring fileNames ={

#Run 30123
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/123/RAW/0000/2E7F227A-B8A1-DC11-AF61-001617DBD564.root",

#Run 30126
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/126/RAW/0000/68D562BD-BDA1-DC11-966B-00304856281C.root",
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/126/RAW/0000/DA2E7195-BBA1-DC11-B9B7-001617E30D54.root",
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/126/RAW/0000/FAC9A91B-BFA1-DC11-894F-000423D991BC.root",
#Run 30261
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/261/RAW/0000/0682E003-3AA3-DC11-B86A-001617E30CD4.root",
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/261/RAW/0000/10A22B99-39A3-DC11-A50E-000423D98C24.root",
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/261/RAW/0000/12DF04CC-39A3-DC11-A31A-001617C3B614.root",
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/261/RAW/0000/7E7171A2-39A3-DC11-8374-001617DBCF44.root",
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/261/RAW/0000/A8A67043-3AA3-DC11-A9BE-003048561126.root",

#Run 30273
		"rfio:/castor/cern.ch/cms/store/data/GlobalNov07/A/000/030/273/RAW/0000/D6F321DA-3FA3-DC11-A121-001617DBD49A.root"

		}

	untracked uint32 debugVebosity = 10
        untracked bool   debugFlag     = true
        }
	untracked PSet maxEvents = {untracked int32 input = -1}


##################################################################################    
#                                                                                # 
#                        R E C O N S T R U C T I O N                             #
#                                                                                #
##################################################################################    


    include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cff" 
    include "Geometry/DTGeometry/data/dtGeometry.cfi"
    include "Geometry/CSCGeometry/data/cscGeometry.cfi"
    include "Geometry/RPCGeometry/data/rpcGeometry.cfi"
    include "Geometry/MuonNumbering/data/muonNumberingInitialization.cfi"

## Geometry

    include "Geometry/CommonDetUnit/data/globalTrackingGeometry.cfi"
    #include "MagneticField/Engine/data/uniformMagneticField.cfi"
    include "RecoMuon/DetLayers/data/muonDetLayerGeometry.cfi"

#################### StandAlone Muon Reco ######################################   

        include "TrackPropagation/SteppingHelixPropagator/data/SteppingHelixPropagatorAny.cfi"
	#replace SteppingHelixPropagatorAny.useMagVolumes = false

	module CosmicMuonSeed = CosmicMuonSeedGenerator {
        	untracked bool EnableDTMeasurement = true
	        untracked bool EnableCSCMeasurement = false
        	untracked string DTRecSegmentLabel = 'dt4DSegments'
	        untracked string CSCRecSegmentLabel = 'cscSegments'
        	int32 MaxSeeds = 10
	        double MaxDTChi2 = 3000
        	double MaxCSCChi2 = 3000
	}

	# Standalone muon producer
	#include "RecoMuon/StandAloneMuonProducer/data/standAloneMuons.cff"
	

	include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
	include "RecoMuon/TrackingTools/data/MuonServiceProxy.cff"
	include "RecoMuon/TrackingTools/data/MuonTrackLoader.cff"
	include "Geometry/CommonDetUnit/data/bareGlobalTrackingGeometry.cfi"
	include "RecoMuon/DetLayers/data/muonDetLayerGeometry.cfi"


	module cosmicMuons = CosmicMuonProducer{ 
	    untracked string MuonSeedCollectionLabel = "CosmicMuonSeed"
	    using MuonServiceProxy
	    using MuonTrackLoaderForCosmic

	    PSet TrajectoryBuilderParameters = {
		string Propagator = "SteppingHelixPropagatorAny"
	        untracked bool BuildTraversingMuon = false
		untracked bool EnableDTMeasurement = true
		untracked bool EnableCSCMeasurement = false
		untracked bool EnableRPCMeasurement = false
		PSet MuonTrajectoryUpdatorParameters = {
		    double MaxChi2 = 30000 #30000 default need to be huge at this step
		    int32 Granularity = 0 #ONLY 0! otherwise may got wrong RH order
		    bool RescaleError = false
		    double RescaleErrorFactor = 1. 
		}	
		PSet BackwardMuonTrajectoryUpdatorParameters = {
		    double MaxChi2 = 9 # (100 default) smaller at this step
		    int32 Granularity = 2 # 2 default
		    bool RescaleError = false
		    double RescaleErrorFactor = 1. 
		}
	        PSet MuonSmootherParameters = {
        	    string Propagator = "SteppingHelixPropagatorAny"
	        }
            }
	}


################ RPC Efficiency From Track #####################################

	module rpcefftrack = RPCEfficiencyFromTrack{
		bool ReadEndCap = false
		bool ReadBarrel = true

		#Cut expressed in cm
		double EfficiencyCut = 20.
 		string PropagatorName = "SteppingHelixPropagatorAny"
		untracked string trajectoryInput =  "cosmicMuons"
		untracked string rpcRecHitLabel = "rpcRecHits"
		bool SelectWheel = true
		int32 Ring = 0
		untracked string EffRootFileName = "/tmp/groselli/RPCEfficiencyFromTrack.root"
		untracked string GlobalRootFileName ="/tmp/groselli/GlobalEfficiencyFromTrack.root"
	}

	service = DaqMonitorROOTBackEnd{}
	service = MonitorDaemon {
	       untracked   bool AutoInstantiate    = false
	       untracked  int32 reconnect_delay    = 5
	       untracked string DestinationAddress = "cmsdaquser0.cern.ch"
	       untracked  int32 SendPort           = 9090
	       untracked string NameAsSource       = "GlobalDQM"
	}


	module out = PoolOutputModule {
                untracked string fileName ="STACosmicMuon.root"
        }




	#GREN path
	#path p = {CosmicMuonSeed,standAloneMuons,rpcefftrack}
	path p = {CosmicMuonSeed, cosmicMuons , rpcefftrack}
	#endpath this_is_the_end = {out}
}
